# TODO

## Pending Tasks

- Improvement: Add to helper the param helgrind to detect data races and deadlocks. When specified, run Valgrind with --tool=helgrind. Update all test result parsing to detect problems from helgrind and not only the memcheck tool.
- Create a simple script to detect public method a class and check a bunch of .cpp test case and report if a method not found in the test code.
- Reorganize the test source code in folders. family/smdb. relational/mysql/ kv/redis/ document/mongodb columnar/scylladb
- NEW FEATURE: Add more examples.
- NEW FEATURE: Add more debug messages?
- PLANNED: Start to using in real project and test how easy is integrate in third party project. Maybe write an INTEGRATION.md to explain how full integrate in a real project.
- PLANNED: More db drivers
   - SQLServer/SysBase?
   - Oracle?
   - DB2?
   - Clickhouse?

## Completed Tasks

- Comprehensive Documentation for New Driver Development and Error Handling (2026-02-04):
  - Created `how_add_new_db_drivers.md`: Comprehensive guide (~1,500 lines) for adding new database drivers
  - Covers all 5 phases: driver files, build configuration, tests, benchmarks, and examples
  - Created `error_handling_patterns.md`: Complete guide (~600 lines) for error handling in cpp_dbc
  - Documents DBException, error codes, and exception-free API (nothrow) patterns
  - Created `shell_script_dependencies.md`: Script call hierarchy and dependencies documentation
  - Updated `.claude/rules/cpp_dbc_conventions.md` with "Adding New Database Drivers" section

- Comprehensive Doxygen API Documentation for All Public Headers (2026-02-04):
  - Added Doxygen-compatible `/** @brief ... */` documentation blocks to all 64 public header files
  - Added inline `cpp` usage examples to all major classes and methods
  - Added `@param`, `@return`, `@throws`, `@see` tags for cross-referencing
  - Covers: core interfaces, config layer, relational/columnar/document/KV interfaces, all 7 driver headers
  - 64 files changed, 2,384 insertions(+), 359 deletions(-)
  - Benefits: IDE tooltip support, Doxygen-ready, self-documenting API

- Driver Header Split Refactoring — One-Class-Per-File (2026-02-03):
  - Split all 7 multi-class `driver_*.hpp` files into individual per-class `.hpp` files in driver subfolders
  - Original `driver_*.hpp` files now serve as pure aggregator headers with only `#include` directives
  - 44 new header files created across 7 driver subdirectories (6,727 lines total)
  - Deleted 4 separate BLOB headers (`mysql_blob.hpp`, `postgresql_blob.hpp`, `sqlite_blob.hpp`, `firebird_blob.hpp`)
  - BLOB classes moved into their respective driver subfolders (e.g., `mysql/blob.hpp`)
  - Removed 25 now-redundant BLOB `#include` directives from source, test, and example files
  - New driver subfolders: `mysql/`, `postgresql/`, `sqlite/`, `firebird/`, `mongodb/`, `scylladb/`, `redis/`
  - Each subfolder has `handles.hpp` for RAII deleters/type aliases, plus per-class headers
  - Backward compatible — external consumers still include `driver_mysql.hpp` etc.
  - Benefits: better LLM comprehension, improved IDE navigation, one-class-per-file convention

- Driver Code Split Refactoring (2026-01-31):
  - Split all database driver implementations into multiple smaller, focused files
  - Each driver now has dedicated subdirectory with internal header and split implementation files
  - SQLite: driver_01.cpp, connection_*.cpp, prepared_statement_*.cpp, result_set_*.cpp, sqlite_internal.hpp
  - MySQL: driver_01.cpp, connection_*.cpp, prepared_statement_*.cpp, result_set_*.cpp, mysql_internal.hpp
  - PostgreSQL: driver_01.cpp, connection_*.cpp, prepared_statement_*.cpp, result_set_*.cpp, postgresql_internal.hpp
  - Firebird: driver_01.cpp, connection_*.cpp, prepared_statement_*.cpp, result_set_*.cpp, firebird_internal.hpp
  - MongoDB: driver_01.cpp, connection_*.cpp, collection_*.cpp, cursor_*.cpp, document_*.cpp, mongodb_internal.hpp
  - Redis: driver_01.cpp, connection_*.cpp, redis_internal.hpp
  - ScyllaDB: driver_01.cpp, connection_*.cpp, prepared_statement_*.cpp, result_set_*.cpp, scylladb_internal.hpp
  - Updated CMakeLists.txt to compile all new split source files
  - Benefits: faster incremental compilation, better code organization, easier navigation

- SonarCloud Code Quality Fixes and Connection Pool Improvements (2026-01-29):
  - Fixed critical race condition in connection pool return flow (m_closed reset before returnConnection)
  - Added ConstructorTag pattern (PassKey idiom) to enable std::make_shared while enforcing factory pattern
  - Added NOSONAR comments with explanations for intentional code patterns
  - Added [[noreturn]] attributes to stub methods that always throw exceptions
  - Changed virtual destructors to override in derived classes
  - Added Rule of 5 to MySQLDBDriver and PostgreSQLDBDriver
  - Changed nested namespace declarations to modern C++17 syntax
  - Fixed TUI initialization in parallel test script to occur after build
  - Enhanced sonar_qube_issues_fetch.sh to fetch all issues when --file not specified

- Parallel Test Execution System (2026-01-28):
  - Added `run_test_parallel.sh` script for running test prefixes in parallel
  - Added `parallel=N` option to helper.sh for running N prefixes concurrently
  - Added `parallel-order=P1_,P2_,...` option to prioritize specific prefixes
  - Added TUI mode with `progress` option for real-time split panel view
  - Added `summarize` option to show summary of past test runs
  - Added `--skip-build` and `--list` flags to run_test.sh
  - Logs saved to `logs/test/YYYY-MM-DD-HH-MM-SS/PREFIX_RUNXX.log`

- SonarCloud Code Quality Fixes (2026-01-20):
  - Consolidated SonarCloud configuration into `.sonarcloud.properties`
  - Deleted redundant `sonar-project.properties` file
  - Added exclusion for cognitive complexity rule (cpp:S3776)
  - Added exclusion for nesting depth rule (cpp:S134)
  - Fixed `explicit` keyword in `FileOutputStream` constructor
  - Fixed redundant member initialization in `MemoryInputStream`
  - Fixed Columnar DB Connection Pool code quality issues:
    - Changed destructor from `virtual` to `override`
    - Added in-class member initialization for atomic variables
    - Changed methods to `const` and `final` where appropriate
    - Replaced `std::lock_guard` with `std::scoped_lock`
    - Replaced generic exception catches with specific `DBException` catches

- ScyllaDB Connection Pool and Driver Enhancements (2026-01-18):
  - Added ColumnarDBConnectionPool base class for columnar databases
  - Added ColumnarPooledDBConnection wrapper class for pooled columnar connections
  - Added Scylla::ScyllaConnectionPool specialized implementation for ScyllaDB
  - Renamed USE_SCYLLA to USE_SCYLLADB for consistency
  - Renamed driver files from driver_scylla to driver_scylladb
  - Renamed namespace from Scylla to ScyllaDB
  - Added comprehensive ScyllaDB examples (blob, json, connection pool)
  - Added ScyllaDB benchmark suite (select, insert, update, delete)
  - Renamed test files from test_scylla_* to test_scylladb_*
  - Added ScyllaDB exception-free API with nothrow variants

- Add benchmarks to SCYLLADB driver
- Add examples to SCYLLADB driver
- Add conection pool interface and class implementation to SCYLLADB driver.
- Add container build the scylladb drvier support
- Cassandra/SCYLLADB driver implementation
- Add DEBUG_SCYLLADB to the driver of SCYLLADB. And relevant intrumentation messages in the driver code.

- PostgreSQL Exception-Free API Implementation:
  - Implemented comprehensive exception-free API for all PostgreSQL driver methods using `std::nothrow_t` parameter
  - Each method now returns `expected<T, DBException>` with detailed error information
  - Replaced "NOT_IMPLEMENTED" placeholder implementations with full functional code
  - Added error handling with unique error codes for each error condition
  - Implemented for connection operations, transaction management, and statement execution
  - Ensures consistent API pattern across all database drivers

- MongoDB benchmark and test improvements:
  - Added comprehensive MongoDB benchmark suite with benchmark_mongodb_select.cpp, benchmark_mongodb_insert.cpp, benchmark_mongodb_update.cpp, benchmark_mongodb_delete.cpp
  - Updated benchmark infrastructure with MongoDB support
  - Added MongoDB memory usage tracking to benchmark baseline
  - Added new MongoDB test files: test_mongodb_real_json.cpp, test_mongodb_thread_safe.cpp, test_mongodb_real_join.cpp
  - Added tests for MongoDB JSON operations, thread safety, and join operations
  - Enhanced helper script with MongoDB command combinations
  
- MongoDB document database driver implementation:
  - Added complete MongoDB driver with document database interfaces
  - Created core document interfaces: DocumentDBConnection, DocumentDBDriver, DocumentDBCollection, DocumentDBCursor, DocumentDBData
  - Implemented MongoDBDriver, MongoDBConnection, MongoDBCollection, MongoDBCursor, MongoDBData classes
  - Added FindMongoDB.cmake for MongoDB C++ driver detection
  - Full CRUD operations: insertOne, insertMany, findOne, find, updateOne, updateMany, replaceOne, deleteOne, deleteMany
  - Aggregation pipeline support
  - Index management: createIndex, dropIndex, listIndexes
  - Collection management: createCollection, dropCollection, listCollections
  - Document data type handling: strings, integers, doubles, booleans, arrays, nested objects, null values
  - Upsert support for update operations
  - Thread-safe operations (conditionally compiled with DB_DRIVER_THREAD_SAFE)
  - Added comprehensive test suite: test_mongodb_common.hpp/cpp, test_mongodb_real.cpp
  - Added MongoDB configuration to test_db_connections.yml
  - Updated all build scripts with --mongodb and --debug-mongodb options

- Directory restructuring for multi-database type support:
  - Moved core interfaces from `relational/` to `core/relational/`
  - Moved driver files from `drivers/` to `drivers/relational/`
  - Created placeholder directories for future database types: columnar, document, graph, kv, timeseries
  - Updated all include paths in source files, tests, benchmarks, and examples
  - Updated CMakeLists.txt with new source file paths
- Connection pool memory safety improvements with smart pointers:
  - Added m_poolAlive shared atomic flag to track pool lifetime
  - RelationalDBPooledConnection now uses weak_ptr for pool reference
  - Added isPoolValid() helper method to check if pool is still alive
  - Pool sets m_poolAlive to false in close() before cleanup
  - Prevents use-after-free when pool is destroyed while connections are in use
- API naming convention refactoring:
  - Renamed driver classes: MySQLDriver → MySQLDBDriver, PostgreSQLDriver → PostgreSQLDBDriver, SQLiteDriver → SQLiteDBDriver, FirebirdDriver → FirebirdDBDriver
  - Renamed connection class: Connection → RelationalDBConnection
  - Renamed config class: ConnectionPoolConfig → DBConnectionPoolConfig
  - Renamed DriverManager method: getConnection() → getDBConnection()
  - Renamed TransactionManager method: getTransactionConnection() → getTransactionDBConnection()
  - Renamed Driver method: connect() → connectRelational()
  - Updated all benchmarks, tests, and examples to use new naming convention
- BLOB memory safety improvements with smart pointers:
  - Migrated all BLOB implementations from raw pointers to weak_ptr for safe connection references
  - FirebirdBlob: Uses weak_ptr<FirebirdConnection> with getConnection() helper
  - MySQLBlob: Uses weak_ptr<MYSQL> with getMySQLConnection() helper
  - PostgreSQLBlob: Uses weak_ptr<PGconn> with getPGConnection() helper
  - SQLiteBlob: Uses weak_ptr<sqlite3> with getSQLiteConnection() helper
  - Added isConnectionValid() method to all BLOB classes
  - Operations throw DBException if connection has been closed (prevents use-after-free)
- Firebird driver database creation and improved error handling:
  - Added `createDatabase()` method to FirebirdDriver for creating new databases
  - Added `command()` method for driver-specific commands
  - Fixed critical bug in error message capture (now saves error BEFORE cleanup)
  - Improved `interpretStatusVector()` with SQLCODE interpretation
  - Added `firebird_reserved_word_example.cpp` example
- Firebird/Interbase driver with comprehensive test coverage and benchmarks:
  - Full driver implementation with BLOB, transaction, and connection pool support
  - Added benchmark suite (SELECT, INSERT, UPDATE, DELETE operations)
  - Added thread-safety tests, JOIN tests, JSON tests, and transaction isolation tests
- Added optional thread-safe database driver operations:
  - Added DB_DRIVER_THREAD_SAFE CMake option (default: ON)
  - Added --db-driver-thread-safe-off option to all build scripts
  - Added mutex protection to MySQL, PostgreSQL, and SQLite drivers
  - Added comprehensive thread-safety stress tests for all drivers
  - Tests include: concurrent connections, connection pool access, stress tests
- Migrated all database drivers from raw pointers to smart pointers:
  - MySQL: Added MySQLResDeleter, MySQLStmtDeleter, MySQLDeleter custom deleters
  - MySQL: Changed m_mysql to shared_ptr, m_stmt to unique_ptr, m_result to unique_ptr
  - MySQL: PreparedStatement uses weak_ptr for safe connection reference
  - PostgreSQL: Added PGresultDeleter, PGconnDeleter custom deleters
  - PostgreSQL: Changed m_conn to shared_ptr, m_result to unique_ptr
  - PostgreSQL: PreparedStatement uses weak_ptr for safe connection reference
  - SQLite: Added SQLiteStmtDeleter, SQLiteDbDeleter custom deleters
  - SQLite: Changed m_db to shared_ptr, m_stmt to unique_ptr
  - SQLite: PreparedStatement uses weak_ptr for safe connection reference
  - SQLite: Changed m_activeStatements from set<shared_ptr> to set<weak_ptr>
  - Benefits: RAII cleanup, exception safety, clear ownership semantics
- Add to benchmark the feature to create a base line to  CPU_RAM_PLATFORM_OS. AMD_Ryzen_9_9950X_16-Core_Processor_16GB_Ubuntu_24_04 an compare with the last match in base line  
- Migrated benchmark system from Catch2 to Google Benchmark:
  - Updated CMakeLists.txt to use Google Benchmark instead of Catch2WithMain
  - Added benchmark/1.8.3 as a dependency in conanfile.txt
  - Rewrote all benchmark files to use Google Benchmark API
  - Improved benchmark table initialization system with table reuse
  - Added support for multiple iterations and benchmark repetitions
  - Added new configuration parameters (--min-time and --repetitions)
  - Added mysql-off option to disable MySQL benchmarks
- Added mtehots begiTransaction() to replace setAutoCommit funcionality
- Reseearch Why sqlite driver is showing warning messages
- Add the feature to messages warning folling the DEBUG_SQLITE flag
- NEW FEATURE: Add benchmarks to 10 100 1000 10000 rows in Insert/Delete/Update/Select Operations
  - Implemented in benchmark directory with files for all database drivers
  - Added benchmark_main.cpp with common benchmark setup
  - Added benchmark files for MySQL, PostgreSQL, and SQLite operations
  - Added support for different data sizes (10, 100, 1000, and 10000 rows)
  - Added `--benchmarks` option to build.sh and `--run-benchmarks` option to helper.sh
- Activate ALL possible warnings and compile time checks
  - Implemented in build_cpp_dbc.sh and build_test_cpp_dbc.sh with flags -Wall -Wextra -Wpedantic -Wconversion -Wshadow -Wcast-qual -Wformat=2 -Wunused -Werror=return-type -Werror=switch -Wdouble-promotion -Wfloat-equal -Wundef -Wpointer-arith -Wcast-align
  - Added definitions for backward.hpp to silence -Wundef warnings
  - Refactored code to use m_ prefix for member variables to avoid -Wshadow
  - Fixed implicit conversions to avoid -Wconversion
  - Improved exception handling to avoid variable shadowing
- Add rpm support using docker fedora 42 and 43
- Add --run-build-lib-dist-deb using docker (implemented as build_dist_pkg.sh)
- Add library dw to linker en CPP_SBC
- Finish to add the license header to .cpp files
- BUG: When no pass the --auto the script is not stop before continue
- NEW FEATURE: Capture the output when the run test to .log file in the helper.sh
- NEW FEATURE: Capture the param --check-test-log in the helper.sh
- NEW FEATURE: Add specific testing of json field types.
- NEW FEATURE: Create a generic function fo capture the callstack java like
- NEW FEATURE: Extend DBException to make more robust add Mark and not concatenated to message
- NEW FEATURE: Extend DBException to make more robust add Call stack where throw the exception
